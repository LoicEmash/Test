Ext.define("AmsUi.form.field.PictureBox",{extend:"Ext.form.field.Text",alias:["widget.picturebox"],requires:["Ext.form.field.FileButton","Ext.form.trigger.Component"],needArrowKeys:false,triggers:{filebutton:{type:"component",hideOnReadOnly:false,preventMouseDown:false}},preSubTpl:['<div id="{cmpId}-triggerWrap" data-ref="triggerWrap" class="{triggerWrapCls} {triggerWrapCls}-{ui}">','<div id={cmpId}-inputWrap data-ref="inputWrap" class="{inputWrapCls} {inputWrapCls}-{ui}"><img alt="Click to edit" width="64" height="64" src="resources/icons/64x64/unknow-user.png"/>'],postSubTpl:["</div>",'<tpl for="triggers">{[values.renderTrigger(parent)]}</tpl>',"</div>"],buttonText:"",buttonOnly:false,buttonMargin:3,clearOnSubmit:true,extraFieldBodyCls:Ext.baseCSSPrefix+"form-file-wrap",inputCls:Ext.baseCSSPrefix+"form-text-file",readOnly:false,editable:true,submitValue:true,triggerNoEditCls:"",childEls:["browseButtonWrap"],applyTriggers:function(a){var b=this,c=(a||{}).filebutton;if(c){c.component=Ext.apply({xtype:"filebutton",ownerCt:b,id:b.id+"-button",ui:b.ui,hidden:true,disabled:b.disabled,text:b.buttonText,style:b.buttonOnly?"":b.getButtonMarginProp()+b.buttonMargin+"px",inputName:b.getName(),listeners:{scope:b,change:b.onFileChange}},b.buttonConfig);return b.callParent([a])}},getSubTplData:function(a){var b=this.callParent([a]);b.inputAttrTpl="multiple";b.name="files[]";return b},onRender:function(){var d=this,e,c,a,b;d.callParent(arguments);e=d.inputEl;e.dom.name="";e.dom.style.display="none";b=d.getTrigger("filebutton");c=d.button=b.component;d.fileInputEl=c.fileInputEl;a=c.el;if(d.buttonOnly){d.inputWrap.setDisplayed(false);d.shrinkWrap=3}b.el.setWidth(a.getWidth()+a.getMargin("lr"));if(Ext.isIE){d.button.getEl().repaint()}d.updateImageSource(d.getValue())},updateImageSource:function(b){var a=this;if(b===""){b=null}if(b===undefined){b=null}var c=a.getEl().down("img").dom;if(b===null){c.src="resources/icons/64x64/unknow-user.png"}else{c.src=b}},getTriggerMarkup:function(){return'<td id="'+this.id+'-browseButtonWrap" data-ref="browseButtonWrap" role="presentation"></td>'},onFileChange:function(b,i,h){var d=this;var c=i.target.files;if(c.length>0){var g=c[0];if(g.type.match("image.*")){var a=new FileReader();a.onload=(function(e){return function(f){d.setValue.call(d,f.target.result);d.updateImageSource(f.target.result)}})(g);a.readAsDataURL(g)}else{d.setValue.call(d,null);d.updateImageSource(null)}}this.duringFileSelect=true;delete this.duringFileSelect},didValueChange:function(){return true},reset:function(){var b=this,a=b.clearOnSubmit;if(b.rendered){b.button.reset(a);b.fileInputEl=b.button.fileInputEl;if(a){b.inputEl.dom.value="";b.setValue.call(b,null);b.updateImageSource(null)}}b.callParent()},onShow:function(){this.callParent();this.button.updateLayout()},onDisable:function(){this.callParent();this.button.disable()},onEnable:function(){this.callParent();this.button.enable()},isFileUpload:Ext.returnTrue,extractFileInput:function(){var b=this,a;if(b.rendered){a=b.button.fileInputEl.dom;b.reset()}else{a=document.createElement("input");a.type="file";a.className=Ext.baseCSSPrefix+"hidden-display";a.name="files[]";a.setAttribute("multiple","true")}return a},restoreInput:function(b){if(this.rendered){var a=this.button;a.restoreInput(b);this.fileInputEl=a.fileInputEl}},onDestroy:function(){this.fileInputEl=this.button=null;this.callParent()},getButtonMarginProp:function(){return"margin-left:"},privates:{getFocusEl:function(){return this.button}},listeners:{afterrender:function(c){var a=this;var b=c.getEl().down("img").dom;b.addEventListener("click",function(){if(a.readOnly===false){a.button.getEl().down("input").dom.click()}},false)},change:function(b,a){b.updateImageSource(a)}}});Ext.define("AmsUi.util.EditRecordPanel",{mixinId:"ams-edit-record-panel",config:{readOnly:true,record:null},setRecord:function(b){this.record=b;if(this.getController()!==undefined&&this.getController()!==null){var a=this.getController();a.setRecord(b)}}});Ext.define("AmsUi.util.EditRecordPanelController",{mixinId:"ams-edit-record-panel-controller",setRecord:function(a){if(this.getViewModel()!==undefined&&this.getViewModel()!==null){var b=this.getViewModel();b.setRecord(a)}},onCancelClick:function(){var a=this.getView().getRecord();this.fireViewEvent("cancelClick",a)},onOkClick:function(){if(this.getViewModel()!==undefined&&this.getViewModel()!==null){var b=this.getViewModel();var a=this.getView().getRecord();b.fillRecord(a);this.fireViewEvent("okClick",a)}}});Ext.define("AmsUi.util.EditRecordPanelModel",{mixinId:"ams-edit-record-panel-model",setRecord:function(a){throw"unimplemented method"},fillRecord:function(a){throw"unimplemented method"}});Ext.define("AmsUi.util.EditRecordService",{requires:["Ext.window.Window","AmsLocale.util.Locale"],singleton:true,deleteRecord:function(c,a,b,d,e){Ext.Msg.show({title:AmsLocale.util.Locale.txtConfirmDelete,message:c,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(f){if(f==="yes"){b.remove(a);b.sync({success:function(){if(d!==undefined){d()}},failure:function(){Ext.Msg.alert(AmsLocale.util.Locale.txtErreur,AmsLocale.util.Locale.txtDbErreur);if(e!==undefined){e()}}})}}})},editRecord:function(g,c,a,b,e,f){var d=Ext.create("Ext.window.Window",{title:g,modal:true,layout:"fit",items:{xtype:c,readOnly:false,record:a,listeners:{okClick:function(h){d.mask(AmsLocale.util.Locale.txtMajDonnees);h.save({callback:function(j,i){if(i.wasSuccessful()&&j!==null){b.load({callback:function(){d.unmask();d.close();if(e!==undefined){e()}}})}else{d.unmask();Ext.Msg.alert(AmsLocale.util.Locale.txtErreur,AmsLocale.util.Locale.txtDbErreur);if(f!==undefined){f()}}}})},cancelClick:function(){d.close()}}}});d.show()}});Ext.define("AmsUi.util.Param",{requires:["AmsDomainPrf.model.PrfUsrParam"],singleton:true,paramStore:null,loadParams:function(a){if(AmsUi.util.Param.paramStore===null){AmsUi.util.Param.paramStore=Ext.create("Ext.data.Store",{model:"AmsDomainPrf.model.PrfUsrParam",autoSync:false,proxy:Ext.create("AmsData.data.proxy.SecureRestProxy",{schema:"Prf",table:"PrfUsrParam",useLimit:false})})}AmsUi.util.Param.paramStore.clearFilter(true);AmsUi.util.Param.paramStore.addFilter({property:"login",value:AmsAuth.util.Authentification.userLogin},true);AmsUi.util.Param.paramStore.load({callback:a})},getParam:function(c,b,a){var d=a;AmsUi.util.Param.paramStore.each(function(e){if(e.get("sch")===c&&e.get("code")===b){d=e.get("val")}});return d},setParam:function(b,a,c){var d=null;AmsUi.util.Param.paramStore.each(function(e){if(e.get("sch")===b&&e.get("code")===a){d=e}});if(d!==null){d.set("val",c)}else{d=Ext.create("AmsDomainPrf.model.PrfUsrParam");d.set("login",AmsAuth.util.Authentification.userLogin);d.set("sch",b);d.set("code",a);d.set("val",c);AmsUi.util.Param.paramStore.add(d)}AmsUi.util.Param.paramStore.sync()}});
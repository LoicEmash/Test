Ext.define("AmsData.data.proxy.SecureRestProxy",{extend:"Ext.data.proxy.Rest",pageParam:false,startParam:false,limitParam:false,appendId:false,pageSize:100,config:{schema:null,table:null,useLimit:false,needestChildTables:null,needestParentTables:null},setNeedestChildTables:function(a){this.needestChildTables=a;this.extraParams={needestChildTables:this.getNeedestChildTables(),needestParentTables:this.getNeedestParentTables()}},setNeedestParentTables:function(a){this.needestParentTables=a;this.extraParams={needestChildTables:this.getNeedestChildTables(),needestParentTables:this.getNeedestParentTables()}},url:"../../serveur/web/app_dev.php/Data",constructor:function(a){this.callParent(arguments);this.setUrl("../../serveur/web/app_dev.php/Data/"+a.schema+"/"+a.table);if(a.useLimit===undefined){a.useLimit=false}else{if(a.useLimit===true){this.setPageParam("page");this.setStartParam("start");this.setLimitParam("limit")}else{this.setPageParam(false);this.setStartParam(false);this.setLimitParam(false)}}},buildUrl:function(){var a=this.callParent(arguments);return a+"&apiKey="+AmsAuth.util.Authentification.apiKey},reader:{type:"json",rootProperty:"datas",dateFormat:"d/m/Y H:i:s",messageProperty:"message",successProperty:"success",totalProperty:"total"},writer:{type:"json",dateFormat:"d/m/Y H:i:s",writeAllFields:false}});Ext.define(null,{override:"Ext.data.Store",isDirty:function(){return(this.getNewRecords().length>0||this.getUpdatedRecords().length>0||this.getRemovedRecords().length>0)}});Ext.define("AmsData.util.Status",{singleton:true,globalProgressBarCmpId:"global-progressbar",requires:["AmsLocale.util.Locale"],setText:function(b){var a=Ext.getCmp(AmsData.util.Status.globalProgressBarCmpId);a.updateText(b)},clear:function(){var a=Ext.getCmp(AmsData.util.Status.globalProgressBarCmpId);a.updateText(AmsLocale.util.Locale.txtPret);a.updateProgress(0)},setProgress:function(b){var a=Ext.getCmp(AmsData.util.Status.globalProgressBarCmpId);a.updateProgress(b/100)}});Ext.define("AmsData.util.Model",{requires:["AmsData.util.Status","AmsLocale.util.Locale"],singleton:true,chainSync:function(b,a,g,e,f){if(b.length===0){callback();return}var d=0;if(f!==undefined){d=f}var c=b[d];if(c.isDirty()===true){c.sync({success:function(){if(d<(b.length-1)){AmsData.util.Model.chainSync(b,a,g,e,d+1)}else{if(Ext.isFunction(a)){if(e!==undefined){a.call(e)}else{a()}}}},failure:function(){if(Ext.isFunction(g)){if(e!==undefined){g.call(e)}else{g()}}}})}else{if(d<(b.length-1)){AmsData.util.Model.chainSync(b,a,g,d+1)}else{if(Ext.isFunction(a)){if(e!==undefined){a.call(e)}else{a()}}}}},chainSave:function(g,a,f,d,e){if(g===undefined){callback();return}if(g.length===0){callback();return}var c=0;if(e!==undefined){c=e}var b=g[c];b.save({callback:function(i,h){if(h.wasSuccessful()&&i!==null){if(c<(g.length-1)){AmsData.util.Model.chainSave(g,a,f,d,c+1)}else{if(Ext.isFunction(a)){if(d!==undefined){a.call(d)}else{a()}}}}else{if(Ext.isFunction(f)){if(d!==undefined){f.call(d)}else{f()}}}}})},chainErase:function(g,a,f,d,e){if(g===undefined){callback();return}if(g.length===0){callback();return}var c=0;if(e!==undefined){c=e}var b=g[c];b.erase({callback:function(i,h){if(h.wasSuccessful()&&i!==null){if(c<(g.length-1)){AmsData.util.Model.chainErase(g,a,f,d,c+1)}else{if(Ext.isFunction(a)){if(d!==undefined){a.call(d)}else{a()}}}}else{if(Ext.isFunction(f)){if(d!==undefined){f.call(d)}else{f()}}}}})},chainLoad:function(h,c,a,j,f){if(h===undefined){callback();return}if(h.length===0){callback();return}var d=0;if(f!==undefined){d=f}var g=h[d];var e=g.getProxy().getModel();if(e!==null){var b=e.create();if(b!==null&&b.tableDisplayName!==undefined){AmsData.util.Status.setText(AmsLocale.util.Locale.txtChargement+" "+b.tableDisplayName)}}if(h.length>0){AmsData.util.Status.setProgress((d/h.length)*100)}g.load({callback:function(k,i){if(i.wasSuccessful()&&k!==null){if(d<(h.length-1)){AmsData.util.Model.chainLoad(h,c,a,j,d+1)}else{if(Ext.isFunction(c)){if(j!==undefined){AmsData.util.Status.clear();c.call(j)}else{AmsData.util.Status.clear();c()}}}}else{if(Ext.isFunction(a)){if(j!==undefined){AmsData.util.Status.clear();a.call(j)}else{AmsData.util.Status.clear();a()}}}}})}});